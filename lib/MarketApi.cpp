#include "MarketApi.h"
std::string json = R"({"meta":{"version":"v1.0","status":200,"copywrite":"https:\/\/steadyapi.com","symbol":"^GSPTSE,^I...","processedTime":"2025-08-29T02:11:23.878251Z"},"body":[{"language":"en-US","region":"US","quoteType":"INDEX","typeDisp":"Index","quoteSourceName":"Delayed Quote","triggerable":true,"customPriceAlertConfidence":"HIGH","currency":"CAD","corporateActions":[],"regularMarketTime":1756412401,"exchange":"TSI","messageBoardId":"finmb_INDEXGSPTSE","exchangeTimezoneName":"America\/Toronto","exchangeTimezoneShortName":"EDT","gmtOffSetMilliseconds":-14400000,"market":"ca_market","esgPopulated":false,"marketState":"POSTPOST","regularMarketChangePercent":0.0063334196,"regularMarketPrice":28434.8,"shortName":"S&P\/TSX Composite index","fiftyDayAverage":27385.885,"fiftyDayAverageChange":1048.916,"fiftyDayAverageChangePercent":0.038301338,"twoHundredDayAverage":25727.766,"twoHundredDayAverageChange":2707.0352,"twoHundredDayAverageChangePercent":0.10521843,"sourceInterval":15,"exchangeDataDelayedBy":0,"tradeable":false,"cryptoTradeable":false,"longName":"S&P\/TSX Composite index","hasPrePostMarketData":false,"firstTradeDateMilliseconds":299511000000,"priceHint":2,"regularMarketChange":1.8007812,"regularMarketDayHigh":28530.19,"regularMarketDayRange":"28349.61 - 28530.19","regularMarketDayLow":28349.61,"regularMarketVolume":203072088,"regularMarketPreviousClose":28433,"bid":28345.63,"ask":28507.2,"bidSize":0,"askSize":0,"fullExchangeName":"Toronto","regularMarketOpen":28505.06,"averageDailyVolume3Month":248251585,"averageDailyVolume10Day":240951410,"fiftyTwoWeekLowChange":6207.1016,"fiftyTwoWeekLowChangePercent":0.27925074,"fiftyTwoWeekRange":"22227.7 - 28530.2","fiftyTwoWeekHighChange":-95.39844,"fiftyTwoWeekHighChangePercent":-0.0033437705,"fiftyTwoWeekLow":22227.7,"fiftyTwoWeekHigh":28530.2,"fiftyTwoWeekChangePercent":21.796263,"symbol":"^GSPTSE","preMarketChange":null,"preMarketChangePercent":null,"preMarketPrice":null,"preMarketTime":null,"postMarketChange":null,"postMarketChangePercent":null,"postMarketPrice":null,"postMarketTime":null},{"language":"en-US","region":"US","quoteType":"INDEX","typeDisp":"Index","quoteSourceName":"Delayed Quote","triggerable":true,"customPriceAlertConfidence":"HIGH","currency":"USD","corporateActions":[],"regularMarketTime":1756415759,"exchange":"NIM","messageBoardId":"finmb_INDEXIXIC","exchangeTimezoneName":"America\/New_York","exchangeTimezoneShortName":"EDT","gmtOffSetMilliseconds":-14400000,"market":"us_market","esgPopulated":false,"marketState":"POSTPOST","regularMarketChangePercent":0.53273195,"regularMarketPrice":21705.158,"shortName":"NASDAQ Composite","fiftyDayAverage":20883.787,"fiftyDayAverageChange":821.3711,"fiftyDayAverageChangePercent":0.03933056,"twoHundredDayAverage":19288.494,"twoHundredDayAverageChange":2416.664,"twoHundredDayAverageChangePercent":0.12529045,"sourceInterval":15,"exchangeDataDelayedBy":0,"tradeable":false,"cryptoTradeable":false,"longName":"NASDAQ Composite","hasPrePostMarketData":false,"firstTradeDateMilliseconds":34612200000,"priceHint":2,"regularMarketChange":115.01758,"regularMarketDayHigh":21742.457,"regularMarketDayRange":"21534.941 - 21742.457","regularMarketDayLow":21534.941,"regularMarketVolume":7063469000,"regularMarketPreviousClose":21590.14,"bid":0,"ask":0,"bidSize":0,"askSize":0,"fullExchangeName":"Nasdaq GIDS","regularMarketOpen":21619.273,"averageDailyVolume3Month":9088153809,"averageDailyVolume10Day":8200237000,"fiftyTwoWeekLowChange":6921.128,"fiftyTwoWeekLowChangePercent":0.46814892,"fiftyTwoWeekRange":"14784.03 - 21803.75","fiftyTwoWeekHighChange":-98.5918,"fiftyTwoWeekHighChangePercent":-0.0045217816,"fiftyTwoWeekLow":14784.03,"fiftyTwoWeekHigh":21803.75,"fiftyTwoWeekChangePercent":22.53374,"symbol":"^IXIC","preMarketChange":null,"preMarketChangePercent":null,"preMarketPrice":null,"preMarketTime":null,"postMarketChange":null,"postMarketChangePercent":null,"postMarketPrice":null,"postMarketTime":null}]}")";

void MarketApi::getEquityInfo(IDataRetriever& retriever,
    std::vector<EquityInfo>& equities) {

    JsonDocument doc;
    DeserializationError error = deserializeJson(doc, json);

    if (error) {
        return;
    }

    for (JsonObject item : doc["body"].as<JsonArray>()) {
        EquityInfo info;
        info.Name = item["shortName"] | "";
        info.Value = item["regularMarketPrice"];
        info.DayChange = item["regularMarketChange"];
        equities.push_back(info);
    }
}